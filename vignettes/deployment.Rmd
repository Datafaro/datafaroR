---
title: "Deployment"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Deployment}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(domar)
```

git>clone
R>check
R>install

create blastula creds file.
blastula::create_smtp_creds_file('domar.email', user = 'domar.email@gmail.com', provider = 'gmail')
Enter password on prompt

cache auth googlesheets4 with account with access to dmr_list file.
https://medium.com/@JosiahParry/googlesheets4-authentication-for-deployment-9e994b4c81d6

domar_run.R
usar rutas absolutas: Esto as\\u00ED porque en mi caso particular el cron est\\u00E1 corriendo en el usuario root, y los archivos est\\u00E1n en el usuario particular
print(Sys.time()) # Para el log del cron.
library(domar)
library(googlesheets4)
myEmail <- 'drdsdaniel@gmail.com'
# Esto es porque tengo users distintos en la m\\u00E1quina de prueba y el servidor.
user <- if(file.exists('/home/drdsdaniel/domar/domar_run.R')){
  'drdsdaniel'
}else{
  'daniel'
}
# Auth
gs4_auth(
  cache = paste0('/home/', user, '/.secrets'),
  email = 'drdsdaniel@gmail.com'
  )
# imae_month
secure_gss(myEmail, paste0('/home/', user,'/domar/domar.email'), 'imae_month', kvars = c('fecha', 'serie', 'Indice'))


configure cron
sudo crontab -e
@hourly /usr/lib/R/bin/Rscript '/home/daniel/domar/domar_run.R'  >> '/home/daniel/domar/domar_run.log' 2>&1
